{% extends "base.html" %}

{% block title %}Analytics - Gold and Bitcoin Predictor{% endblock %}

{% block content %}
<div class="bg-white shadow-md rounded-lg overflow-hidden">
    <div class="p-8">
        <!-- Header Section -->
        <div class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-chart-bar mr-3 text-purple-600"></i>
                    Enhanced Analytics Dashboard
                </h1>
                <p class="text-gray-600">
                    Advanced visualizations and market analysis with technical indicators and correlations
                </p>
            </div>
            <div class="flex gap-3">
                <button id="refresh-data" onclick="refreshAllCharts()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors duration-200 btn-enhanced">
                    <i class="fas fa-sync-alt mr-2"></i>Refresh Data
                </button>
                <button onclick="exportCharts()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors duration-200 btn-enhanced">
                    <i class="fas fa-download mr-2"></i>Export
                </button>
            </div>
        </div>

        <!-- Market Overview Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="gradient-gold p-4 rounded-lg shadow-lg text-white card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-2xl font-bold" id="gold-overview-price">Loading...</div>
                        <div class="text-sm opacity-90">Gold (USD/oz)</div>
                        <div class="text-xs mt-1" id="gold-overview-change">--</div>
                    </div>
                    <i class="fas fa-coins text-3xl opacity-75"></i>
                </div>
            </div>

            <div class="gradient-bitcoin p-4 rounded-lg shadow-lg text-white card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-2xl font-bold" id="bitcoin-overview-price">Loading...</div>
                        <div class="text-sm opacity-90">Bitcoin (USD)</div>
                        <div class="text-xs mt-1" id="bitcoin-overview-change">--</div>
                    </div>
                    <i class="fab fa-bitcoin text-3xl opacity-75"></i>
                </div>
            </div>

            <div class="gradient-primary p-4 rounded-lg shadow-lg text-white card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-2xl font-bold" id="sp500-overview-value">Loading...</div>
                        <div class="text-sm opacity-90">S&P 500</div>
                        <div class="text-xs mt-1" id="sp500-overview-change">--</div>
                    </div>
                    <i class="fas fa-chart-area text-3xl opacity-75"></i>
                </div>
            </div>

            <div class="bg-gradient-to-br from-gray-600 to-gray-800 p-4 rounded-lg shadow-lg text-white card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-2xl font-bold" id="oil-overview-price">Loading...</div>
                        <div class="text-sm opacity-90">Brent Oil (USD/bbl)</div>
                        <div class="text-xs mt-1" id="oil-overview-change">--</div>
                    </div>
                    <i class="fas fa-oil-can text-3xl opacity-75"></i>
                </div>
            </div>
        </div>

        <!-- Chart Controls -->
        <div class="bg-gray-50 p-4 rounded-lg shadow mb-6">
            <div class="flex flex-wrap items-center gap-4">
                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700">Time Range:</label>
                    <select id="time-range" onchange="updateTimeRange()" class="form-enhanced rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 text-sm">
                        <option value="30">Last 30 Days</option>
                        <option value="60">Last 60 Days</option>
                        <option value="90" selected>Last 90 Days</option>
                        <option value="180">Last 6 Months</option>
                    </select>
                </div>
                
                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700">Chart Type:</label>
                    <select id="chart-type" onchange="updateChartType()" class="form-enhanced rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 text-sm">
                        <option value="line">Line Chart</option>
                        <option value="candlestick">Candlestick</option>
                        <option value="area">Area Chart</option>
                    </select>
                </div>

                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700">Technical Indicators:</label>
                    <label class="flex items-center">
                        <input type="checkbox" id="show-ma" onchange="toggleIndicators()" checked class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                        <span class="ml-1 text-sm">Moving Avg</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="show-volatility" onchange="toggleIndicators()" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                        <span class="ml-1 text-sm">Volatility</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Main Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Gold Price Chart -->
            <div class="bg-gray-50 p-6 rounded-lg shadow card-hover">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">
                        <i class="fas fa-coins mr-2 text-yellow-500"></i>Gold Price Analysis
                    </h2>
                    <div class="flex gap-2">
                        <button onclick="toggleGoldIndicators()" class="text-sm bg-yellow-100 text-yellow-800 px-2 py-1 rounded hover:bg-yellow-200 transition-colors duration-200">
                            <i class="fas fa-cog mr-1"></i>Indicators
                        </button>
                        <button onclick="fullscreenChart('goldChart')" class="text-sm bg-gray-100 text-gray-800 px-2 py-1 rounded hover:bg-gray-200 transition-colors duration-200">
                            <i class="fas fa-expand mr-1"></i>Expand
                        </button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="goldChart"></canvas>
                </div>
                <div class="mt-4 text-sm text-gray-600">
                    <div class="flex justify-between">
                        <span>24h Change: <span id="gold-24h-change" class="font-medium">Loading...</span></span>
                        <span>Volatility: <span id="gold-volatility" class="font-medium">Loading...</span></span>
                    </div>
                </div>
            </div>
            
            <!-- Bitcoin Price Chart -->
            <div class="bg-gray-50 p-6 rounded-lg shadow card-hover">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">
                        <i class="fab fa-bitcoin mr-2 text-orange-500"></i>Bitcoin Price Analysis
                    </h2>
                    <div class="flex gap-2">
                        <button onclick="toggleBitcoinIndicators()" class="text-sm bg-orange-100 text-orange-800 px-2 py-1 rounded hover:bg-orange-200 transition-colors duration-200">
                            <i class="fas fa-cog mr-1"></i>Indicators
                        </button>
                        <button onclick="fullscreenChart('bitcoinChart')" class="text-sm bg-gray-100 text-gray-800 px-2 py-1 rounded hover:bg-gray-200 transition-colors duration-200">
                            <i class="fas fa-expand mr-1"></i>Expand
                        </button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="bitcoinChart"></canvas>
                </div>
                <div class="mt-4 text-sm text-gray-600">
                    <div class="flex justify-between">
                        <span>24h Change: <span id="bitcoin-24h-change" class="font-medium">Loading...</span></span>
                        <span>Volatility: <span id="bitcoin-volatility" class="font-medium">Loading...</span></span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Secondary Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Market Correlation Chart -->
            <div class="bg-gray-50 p-6 rounded-lg shadow card-hover">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">
                        <i class="fas fa-project-diagram mr-2 text-purple-500"></i>Market Correlation Analysis
                    </h2>
                    <select id="correlation-period" onchange="updateCorrelationChart()" class="text-sm form-enhanced rounded border-gray-300">
                        <option value="30">30 Days</option>
                        <option value="60" selected>60 Days</option>
                        <option value="90">90 Days</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="correlationChart"></canvas>
                </div>
                <div class="mt-4 text-sm text-gray-600">
                    <p>This scatter plot shows the correlation between Gold and Bitcoin prices. Strong correlation indicates similar market movements.</p>
                </div>
            </div>
            
            <!-- Volatility Comparison Chart -->
            <div class="bg-gray-50 p-6 rounded-lg shadow card-hover">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">
                        <i class="fas fa-wave-square mr-2 text-red-500"></i>Volatility Comparison
                    </h2>
                    <select id="volatility-window" onchange="updateVolatilityChart()" class="text-sm form-enhanced rounded border-gray-300">
                        <option value="7">7-Day Window</option>
                        <option value="14" selected>14-Day Window</option>
                        <option value="30">30-Day Window</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="volatilityChart"></canvas>
                </div>
                <div class="mt-4 text-sm text-gray-600">
                    <p>Rolling volatility shows price stability patterns. Higher volatility indicates greater price uncertainty.</p>
                </div>
            </div>
        </div>

        <!-- Technical Indicators Panel -->
        <div class="bg-gray-50 p-6 rounded-lg shadow mb-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-6">
                <i class="fas fa-chart-line mr-2 text-blue-500"></i>Technical Indicators Dashboard
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Gold Technical Indicators -->
                <div class="bg-white p-4 rounded-lg border">
                    <h3 class="font-semibold text-lg mb-4 text-yellow-700">
                        <i class="fas fa-coins mr-2"></i>Gold Technical Analysis
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">RSI (14):</span>
                            <span id="gold-rsi" class="font-medium">Loading...</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">MACD:</span>
                            <span id="gold-macd" class="font-medium">Loading...</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Bollinger Position:</span>
                            <span id="gold-bollinger" class="font-medium">Loading...</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Moving Avg (20):</span>
                            <span id="gold-ma20" class="font-medium">Loading...</span>
                        </div>
                    </div>
                </div>

                <!-- Bitcoin Technical Indicators -->
                <div class="bg-white p-4 rounded-lg border">
                    <h3 class="font-semibold text-lg mb-4 text-orange-700">
                        <i class="fab fa-bitcoin mr-2"></i>Bitcoin Technical Analysis
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">RSI (14):</span>
                            <span id="bitcoin-rsi" class="font-medium">Loading...</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">MACD:</span>
                            <span id="bitcoin-macd" class="font-medium">Loading...</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Bollinger Position:</span>
                            <span id="bitcoin-bollinger" class="font-medium">Loading...</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Moving Avg (20):</span>
                            <span id="bitcoin-ma20" class="font-medium">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Key Insights -->
        <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg shadow mb-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">
                <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>Enhanced Market Insights
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-medium text-gray-700 mb-2">Market Patterns:</h3>
                    <ul class="text-sm text-gray-600 space-y-1" id="market-patterns">
                        <li><i class="fas fa-spinner fa-spin mr-2"></i>Analyzing market patterns...</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-medium text-gray-700 mb-2">Risk Assessment:</h3>
                    <ul class="text-sm text-gray-600 space-y-1" id="risk-assessment">
                        <li><i class="fas fa-spinner fa-spin mr-2"></i>Calculating risk metrics...</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="flex justify-center gap-4">
            <a href="{{ url_for('models') }}" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors duration-200 btn-enhanced">
                <i class="fas fa-brain mr-2"></i>Try Prediction Models
            </a>
            <button onclick="generateReport()" class="bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-lg transition-colors duration-200 btn-enhanced">
                <i class="fas fa-file-alt mr-2"></i>Generate Report
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Chart instances
    let goldChart, bitcoinChart, correlationChart, volatilityChart;
    let chartData = {};
    let technicalIndicators = {};

    // Initialize analytics dashboard
    document.addEventListener('DOMContentLoaded', function() {
        initializeCharts();
        loadAnalyticsData();
        loadTechnicalIndicators();
        
        // Auto-refresh every 2 minutes
        setInterval(refreshAllCharts, 120000);
    });

    // Initialize all charts
    function initializeCharts() {
        // Gold price chart with technical indicators
        goldChart = createPriceChart('goldChart', 'Gold Price', '#f59e0b');
        
        // Bitcoin price chart with technical indicators  
        bitcoinChart = createPriceChart('bitcoinChart', 'Bitcoin Price', '#f97316');
        
        // Correlation scatter plot
        const correlationCtx = document.getElementById('correlationChart').getContext('2d');
        correlationChart = new Chart(correlationCtx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Gold vs Bitcoin Correlation',
                    data: [],
                    backgroundColor: 'rgba(139, 69, 19, 0.6)',
                    borderColor: 'rgba(139, 69, 19, 1)',
                    pointRadius: 3,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `Gold: ${formatCurrency(context.parsed.x)}, Bitcoin: ${formatCurrency(context.parsed.y)}`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Gold Price (USD)'
                        },
                        ticks: {
                            callback: function(value) {
                                return formatCurrency(value);
                            }
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Bitcoin Price (USD)'
                        },
                        ticks: {
                            callback: function(value) {
                                return formatCurrency(value);
                            }
                        }
                    }
                }
            }
        });

        // Volatility comparison chart
        const volatilityCtx = document.getElementById('volatilityChart').getContext('2d');
        volatilityChart = new Chart(volatilityCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Gold Volatility',
                        data: [],
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Bitcoin Volatility',
                        data: [],
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    x: {
                        display: true,
                        title: {
                            display: true,
                            text: 'Date'
                        }
                    },
                    y: {
                        display: true,
                        title: {
                            display: true,
                            text: 'Volatility (%)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toFixed(2) + '%';
                            }
                        }
                    }
                },
                interaction: {
                    mode: 'nearest',
                    axis: 'x',
                    intersect: false
                }
            }
        });
    }

    // Load analytics data from enhanced API
    async function loadAnalyticsData() {
        try {
            showLoading('refresh-data', 'Loading...');
            
            // Load main market data
            const dataResponse = await apiCall('/api/data/summary');
            if (dataResponse.success) {
                updateMarketOverview(dataResponse.data);
                await updateMainCharts(dataResponse.data);
            }
            
            // Load technical indicators
            await loadTechnicalIndicators();
            
            hideLoading('refresh-data');
            showToast('Analytics data loaded successfully', 'success');
            
        } catch (error) {
            console.error('Failed to load analytics data:', error);
            hideLoading('refresh-data');
            showToast('Failed to load analytics data', 'error');
        }
    }

    // Update market overview cards
    function updateMarketOverview(data) {
        if (data.numeric_summary) {
            const assets = {
                'gold': 'Gold',
                'bitcoin': 'BITCOIN',
                'sp500': 'S&P500',
                'oil': 'Brent Oil'
            };

            Object.entries(assets).forEach(([key, column]) => {
                if (data.numeric_summary[column]) {
                    const summary = data.numeric_summary[column];
                    const currentPrice = summary.max || summary.mean || 0;
                    
                    document.getElementById(`${key}-overview-price`).textContent = formatCurrency(currentPrice);
                    
                    // Calculate mock change (in real app, this would come from API)
                    const change = (Math.random() - 0.5) * 0.1;
                    const changeElement = document.getElementById(`${key}-overview-change`);
                    changeElement.textContent = formatPercentage(change);
                    addPriceChangeClass(changeElement, change);
                }
            });
        }
    }

    // Update main price charts with enhanced data
    async function updateMainCharts(data) {
        try {
            // Generate sample data for charts (in real app, this would come from API)
            const timeRange = parseInt(document.getElementById('time-range').value);
            const dates = generateDateRange(timeRange);
            
            // Update gold chart
            if (data.numeric_summary && data.numeric_summary.Gold) {
                const goldData = generateSamplePriceData(data.numeric_summary.Gold.mean, timeRange);
                updatePriceChart(goldChart, dates, goldData, 'Gold');
                
                // Update gold statistics
                updateAssetStatistics('gold', goldData);
            }
            
            // Update bitcoin chart
            if (data.numeric_summary && data.numeric_summary.BITCOIN) {
                const bitcoinData = generateSamplePriceData(data.numeric_summary.BITCOIN.mean, timeRange);
                updatePriceChart(bitcoinChart, dates, bitcoinData, 'Bitcoin');
                
                // Update bitcoin statistics
                updateAssetStatistics('bitcoin', bitcoinData);
                
                // Update correlation chart
                updateCorrelationChart(data.numeric_summary.Gold.mean, data.numeric_summary.BITCOIN.mean, timeRange);
            }
            
            // Update volatility chart
            updateVolatilityChart(dates);
            
        } catch (error) {
            console.error('Failed to update charts:', error);
        }
    }

    // Update price chart with technical indicators
    function updatePriceChart(chart, dates, priceData, asset) {
        if (!chart) return;
        
        chart.data.labels = dates;
        chart.data.datasets[0].data = priceData;
        
        // Add moving average if enabled
        if (document.getElementById('show-ma').checked) {
            const maData = calculateMovingAverage(priceData, 20);
            
            // Add or update MA dataset
            let maDataset = chart.data.datasets.find(d => d.label.includes('MA'));
            if (!maDataset) {
                maDataset = {
                    label: `${asset} MA(20)`,
                    data: maData,
                    borderColor: asset === 'Gold' ? '#dc2626' : '#7c3aed',
                    backgroundColor: 'transparent',
                    borderWidth: 2,
                    pointRadius: 0,
                    tension: 0.4
                };
                chart.data.datasets.push(maDataset);
            } else {
                maDataset.data = maData;
            }
        } else {
            // Remove MA dataset
            chart.data.datasets = chart.data.datasets.filter(d => !d.label.includes('MA'));
        }
        
        chart.update('none');
    }

    // Update asset statistics
    function updateAssetStatistics(asset, priceData) {
        if (priceData.length < 2) return;
        
        // Calculate 24h change
        const change24h = ((priceData[priceData.length - 1] - priceData[priceData.length - 2]) / priceData[priceData.length - 2]) * 100;
        const changeElement = document.getElementById(`${asset}-24h-change`);
        changeElement.textContent = formatPercentage(change24h);
        addPriceChangeClass(changeElement, change24h);
        
        // Calculate volatility
        const volatility = calculateVolatility(priceData.slice(-14)); // 14-day volatility
        document.getElementById(`${asset}-volatility`).textContent = volatility.toFixed(2) + '%';
    }

    // Load and display technical indicators
    async function loadTechnicalIndicators() {
        try {
            // In a real app, this would call the API for technical indicators
            // For now, we'll simulate the data
            const indicators = await simulateTechnicalIndicators();
            
            updateTechnicalIndicatorsDisplay(indicators);
            updateMarketInsights(indicators);
            
        } catch (error) {
            console.error('Failed to load technical indicators:', error);
        }
    }

    // Update technical indicators display
    function updateTechnicalIndicatorsDisplay(indicators) {
        const assets = ['gold', 'bitcoin'];
        
        assets.forEach(asset => {
            const assetIndicators = indicators[asset] || {};
            
            document.getElementById(`${asset}-rsi`).textContent = 
                assetIndicators.rsi ? assetIndicators.rsi.toFixed(2) : 'N/A';
            document.getElementById(`${asset}-macd`).textContent = 
                assetIndicators.macd ? assetIndicators.macd.toFixed(4) : 'N/A';
            document.getElementById(`${asset}-bollinger`).textContent = 
                assetIndicators.bollinger ? assetIndicators.bollinger.toFixed(2) : 'N/A';
            document.getElementById(`${asset}-ma20`).textContent = 
                assetIndicators.ma20 ? formatCurrency(assetIndicators.ma20) : 'N/A';
        });
    }

    // Update market insights based on technical analysis
    function updateMarketInsights(indicators) {
        const patterns = [];
        const risks = [];
        
        // Analyze patterns
        if (indicators.gold?.rsi > 70) {
            patterns.push('Gold showing overbought conditions (RSI > 70)');
        } else if (indicators.gold?.rsi < 30) {
            patterns.push('Gold showing oversold conditions (RSI < 30)');
        }
        
        if (indicators.bitcoin?.rsi > 70) {
            patterns.push('Bitcoin showing overbought conditions (RSI > 70)');
        } else if (indicators.bitcoin?.rsi < 30) {
            patterns.push('Bitcoin showing oversold conditions (RSI < 30)');
        }
        
        if (Math.abs(indicators.gold?.macd || 0) > 0.01) {
            patterns.push('Gold MACD indicating potential trend change');
        }
        
        // Analyze risks
        if ((indicators.bitcoin?.volatility || 0) > 15) {
            risks.push('High Bitcoin volatility detected - increased risk');
        }
        
        if ((indicators.gold?.volatility || 0) > 5) {
            risks.push('Elevated Gold volatility - market uncertainty');
        }
        
        const correlation = calculateCorrelation();
        if (Math.abs(correlation) > 0.7) {
            risks.push(`Strong correlation (${correlation.toFixed(2)}) between Gold and Bitcoin`);
        }
        
        // Update displays
        updateInsightsList('market-patterns', patterns.length ? patterns : ['Markets showing normal trading patterns']);
        updateInsightsList('risk-assessment', risks.length ? risks : ['Risk levels within normal parameters']);
    }

    // Update insights list
    function updateInsightsList(elementId, insights) {
        const element = document.getElementById(elementId);
        element.innerHTML = '';
        
        insights.forEach(insight => {
            const li = document.createElement('li');
            li.innerHTML
